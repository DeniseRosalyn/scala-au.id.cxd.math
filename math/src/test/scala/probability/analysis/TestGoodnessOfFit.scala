package probability.analysis

import au.id.cxd.math.probability.analysis.AndersonDarling
import au.id.cxd.math.probability.continuous.Normal
import org.scalatest.{FlatSpec, Matchers}

class TestGoodnessOfFit extends FlatSpec with Matchers {

  /**
    * test random weibull distribution with shape=1 and scale=5
    * This is not normally distributed and shapiro.test in R returns p-value below 0.05
    */
  val weibullTest = Seq(0.064990776417656,0.210998473253566,1.60170329280426,0.567815142449451,0.283022044605126,1.00462365480047,0.278252274504686,0.198869218354005,0.0438059026040631,0.295200508805264,0.684711724022289,0.808870435541965,1.21713061618784,4.0774693220686,0.152165870672591,2.21413622607561,0.368639245540462,0.784392906145808,0.304752099324078,3.5054042082999,0.458057403954571,0.918273704452984,1.21923282537361,0.695206457845635,0.0694670817560684,0.235434055467402,0.789238661102747,0.66209312598467,0.904309814552681,0.757242612435739,0.0705611205627269,0.297451076308604,0.914572089930884,1.28830329988866,4.74109082350975,1.55969731577955,0.601482439232455,1.14603661973681,0.0712201866649113,0.770914586344631,0.0367767686282285,0.622093171857565,0.628666664057825,1.1425443098409,1.27297330349969,0.269038540391177,0.219870765370464,0.75980743943572,0.322822579211546,0.230484990557453,1.51940825698355,0.758137033721467,0.89652940763955,0.145540408546067,0.125988345076142,1.34346177172647,3.15005045746883,0.189705098694489,0.721380169393653,0.302779141960728,0.44362942351172,0.98266040762904,0.220766771407797,1.8657571892886,0.453704312718246,0.190824695053154,0.434089503994289,0.853011944171231,0.193960492305281,0.168367191399449,0.719411692323876,0.806403667794652,0.242860556303696,2.0130675077341,1.34404692542406,0.578205260934426,0.928189371649324,0.662068778284128,0.297788890114579,0.16336007363944,0.865553575631417,0.243075981729076,0.016592670067671,2.97239519950047,1.72964523074672,2.0661172911915,0.276737278861772,0.603541959426477,1.91040613601328,2.48202084211351,0.637196701308824,0.179753872000948,0.0485712658404621,0.60325419981374,1.35103037555615,0.608274309464054,0.292435651227868,0.749910659235974,0.754049050419532,3.13515535529026
  )


  "weibull" should "not test as normal" in {
    val samples = weibullTest
    val norm = Normal(mu=0.0)(1.0)
    val cdf = (x:Double) => norm.cdf(x)
    val test = AndersonDarling(samples, cdf)
    val result = test.test(0.05)
    println(result.toString)
    // should reject the null hypothesis
    result.reject should be (true)
  }

}
